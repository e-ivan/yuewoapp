<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<LINK rel="Bookmark" href="/favicon.ico" >
<LINK rel="Shortcut Icon" href="/favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<script type="text/javascript" src="lib/PIE_IE678.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.7/iconfont.css" />
<link rel="stylesheet" type="text/css" href="lib/icheck/icheck.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<!--/meta 作为公共模版分离出去-->
<style>
  .pic{
    opacity: 0;
  }
</style>
<title>添加剧组</title>
</head>
<body>
<div class="layui-layer-title tab" style="cursor: pointer;">添加剧组</div>

<span class="layui-layer-setwin"><a class="layui-layer-ico layui-layer-close layui-layer-close1" href="javascript:;" onclick="window.location.href='article-list.html'"></a></span>
<article class="page-container">
	<div class="form form-horizontal" id="form-article-add">
		<div class="row cl">
                  <label class="form-label col-xs-4 col-sm-2">剧组名称：</label>
                  <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="请输入剧组名称" id="d_fl" >
                  </div>
            </div>
            <div class="row cl">
                  <label class="form-label col-xs-4 col-sm-2">影片类型：</label>
                  <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="请输入影片类型"  id="d_name" >
                  </div>
            </div>
            <div class="row cl">
                  <label class="form-label col-xs-4 col-sm-2">发布平台：</label>
                  <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="请输入发布平台"  id="d_type" >
                  </div>
            </div>
            <div class="row cl">
                  <label class="form-label col-xs-4 col-sm-2">开机时间：</label>
                  <div class="formControls col-xs-8 col-sm-9">
                        <input type="date" class="input-text" value="" placeholder="请输入开机时间"  id="d_move" >
                  </div>
            </div>
            <div class="row cl">
                  <label class="form-label col-xs-4 col-sm-2">开始招聘时间：</label>
                  <div class="formControls col-xs-8 col-sm-9">
                        <input type="date" class="input-text" value="" placeholder="请输入开始招聘时间"  id="d_time" >
                  </div>
            </div>
            <div class="row cl">
                  <label class="form-label col-xs-4 col-sm-2">结束招聘时间：</label>
                  <div class="formControls col-xs-8 col-sm-9">
                        <input type="date" class="input-text" value="" placeholder="请输入结束招聘时间"  id="d_location" >
                  </div>
            </div>
            <div class="row cl">
                  <label class="form-label col-xs-4 col-sm-2">拍摄地点：</label>
                  <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="请输入拍摄地点"  id="d_long" >
                  </div>
            </div>
            <div class="row cl">
                  <label class="form-label col-xs-4 col-sm-2">拍摄周期：</label>
                  <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value=""  placeholder="请输入拍摄周期"  id="d_start" >
                  </div>
            </div>
            <div class="row cl">
                  <label class="form-label col-xs-4 col-sm-2">影片题材：</label>
                  <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="请输入影片题材"  id="d_end" style="width: 200px;">
                        <span style="display: inline-block;cursor: pointer;color: red;margin-left: 10px;font-size: 16px;" id="add_type"><i class='Hui-iconfont'> &#xe604;</i>*添加题材</span>
                        <div id="d-dtype" style="margin-top: 10px">
                        </div>
                  </div>
            </div>
            <div class="row cl">
             <label class="form-label col-xs-4 col-sm-2"><a href="javascript:;" id="sub" style="display: block;padding: .65rem;background: red;text-align: center;color: #fff;width: 80px;float: right;margin-right: -135px;">添加</a></label>
            </div>
            <div class="row cl pic">
            <label class="form-label col-xs-4 col-sm-2">添加剧组图片：</label>
            <div class="col-sm-9">
            <div id="picker" style="position: relative;width: 108px;height: 128px;line-height: 128px;text-align: center;border: 1px solid #ddd;float: left">&nbsp;&nbsp;&nbsp;&nbsp;</div>
                <div id="thelist" class="uploader-list " style="float: left;margin-bottom: 10px"></div>
            </div>
        </div>
             <div class="row cl pic">
             <label class="form-label col-xs-4 col-sm-2"><a href="javascript:;" id="sub1" style="display: block;padding: .65rem;background: red;text-align: center;color: #fff;width: 80px;float: right;margin-right: -135px;margin-top: 20px;">添加</a></label>
            </div>
	</div>
</article>
<input type="hidden" value="" id="posId">
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="lib/icheck/jquery.icheck.min.js"></script> 
<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.min.js"></script> 
<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script> 
<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.min.js"></script> 
<script type="text/javascript" src="static/h-ui/js/H-ui.js"></script> 
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="lib/jquery.cookie.js"></script>
<script type="text/javascript" src="lib/common.js"></script>
<!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/My97DatePicker/WdatePicker.js"></script>  
<script type="text/javascript" src="lib/webuploader/0.1.5/webuploader.js"></script> 

</body>
</html>
<script>
$(function(){
      $("#add_type").click(function(){
            var div="<p><input type='text' class='input-text' value='' placeholder='请输入影片题材'  class='d_end' style='width: 200px;'><span style='display: inline-block;cursor: pointer;color: red;margin-left: 10px;font-size: 16px;' class='d_del'><i class='Hui-iconfont'> &#xe6a1;</i></span></p>";
            $("#d-dtype").append(div);
            $(".d_del").click(function(){
                $(this).parent().remove();
            })
      })
	var userId = $.cookie("userId");
	var roleType = $.cookie("roleType");
	var username = $.cookie("username");
	if(userId==""||userId==null){
		window.location.href="login.html"
	}
})
$("#sub").click(function(){
    var id=$.cookie("userId");
    var accessToken=$.cookie("accessToken");
	var name=$("#d_fl").val();
    var genre=$("#d_name").val();
    var publishPlatform=$("#d_type").val();
    var openTime=$("#d_move").val();
    var startRecruitTime=$("#d_time").val();
    var endRecruitTime=$("#d_location").val();
    var shootingLocation=$("#d_long").val();
    var shootingCycle=$("#d_start").val();
    var type=$("#d_end").val();
    var ln=$("#d-dtype p input");
    if (ln.length==0) {
        type+="";
    }else{
        for(var i=0;i<ln.length;i++){
            type+="|"+ln[i].value;
        }
    }
      if (name==""||genre==""||publishPlatform==""||openTime==""||startRecruitTime==""||endRecruitTime==""||shootingLocation==""||shootingCycle==""||type=="") {
            alert("请正确添加剧组")
      }else{
      	$.ajax({
            	  url: getRootPath_dc() + '/crew/saveCrew',
                  type: "post",
                  dataType: "json",
                  headers:{tokenUserId:id,accessToken:accessToken},
                  data:{name:name,genre:genre,publishPlatform:publishPlatform,openTime:openTime,startRecruitTime:startRecruitTime,endRecruitTime:endRecruitTime,shootingLocation:shootingLocation,shootingCycle:shootingCycle,type:type},
                  success:function(data){
            		console.log(data)
                    var fkPurposeId=data.data.id;
                    $("#posId").val(fkPurposeId)
                    alert(data.msg);
                      // 添加剧组图片
                      $(function(){
                         var $list = $('#thelist');
                         var $btn1 = $('#sub1');
                         var thumbnailWidth = 100;  
                         var thumbnailHeight = 100;
                         var fkPurposeId=data.data.id;
                         var uploader
                             uploader = WebUploader.create({
                                auto: false,  
                                swf: 'js/Uploader.swf',  
                                server: getRootPath_dc() + '/file/uploadFile',  
                                pick: '#picker',
                                fileVal:'uploadFile', 
                                formData: {'fileType':'image','filePurpose':'crewPhoto','fkPurposeId':fkPurposeId},
                                fileNumLimit:3,
                                threads:3,
                                chunkRetry:3,
                                accept: {  
                                    title: 'Images',  
                                    extensions: 'gif,jpg,jpeg,bmp,png',  
                                    mimeTypes: 'image/*'  
                                },  
                                method:'post',  
                         });
                          uploader.on( 'fileQueued', function( file ) {
                              var $li = $(
                                      '<div id="' + file.id + '" class="file-item thumbnail remove-this">' +
                                          '<img>' +
                                          '<div class="info">' + file.name + '</div>' +
                                      '</div>'
                                      ),
                                  $img = $li.find('img');


                              // $list为容器jQuery实例
                              
                              
                                 $list.prepend( $li );
                              // 创建缩略图
                              // 如果为非图片文件，可以不用调用此方法。
                              // thumbnailWidth x thumbnailHeight 为 100 x 100
                              uploader.makeThumb( file, function( error, src ) {
                                  if ( error ) {
                                      $img.replaceWith('<span>不能预览</span>');
                                      return;
                                  }
                                      $img.attr( 'src', src );
                                  }, thumbnailWidth, thumbnailHeight );
                              // $(".remove-this").live('click', function() {
                              //    alert(0)
                              //     uploader.removeFile(file,true);
                              // })
                         });
                         uploader.on( 'uploadSuccess', function( file ) {  
                             alert( file.name+'上传成功');
                             console.log(file)
                         }); 
                          uploader.on( 'uploadError', function( file ) {  
                              var $li = $( '#'+file.id ),  
                                  $error = $li.find('div.error');  
                         
                              // 避免重复创建  
                              if ( !$error.length ) {  
                                  $error = $('<div class="error"></div>').appendTo( $li );  
                              }  
                         
                              $error.text('上传失败');  
                          });  
                             $btn1.on( 'click', function() { 
                              var fkPurposeId=$("#posId").val();
                              if (fkPurposeId=="") {
                                  alert("上传有误");
                              }else{
                                  uploader.upload();
                              }
                             }); 
                      })
                      // 添加图片结束
                  },
                  complete:function(data){
                     $(".pic").css("opacity","1")
                  }
      	})
      }
})

function getQueryString(id) { 
    var reg = new RegExp("(^|&)" + id + "=([^&]*)(&|$)", "i"); 
    var r = window.location.search.substr(1).match(reg); 
    if (r != null) return unescape(r[2]); return null; 
} 

</script>