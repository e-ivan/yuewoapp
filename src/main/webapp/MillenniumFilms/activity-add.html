<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<LINK rel="Bookmark" href="/favicon.ico" >
<LINK rel="Shortcut Icon" href="/favicon.ico" />
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<script type="text/javascript" src="lib/PIE_IE678.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.7/iconfont.css" />
<link rel="stylesheet" type="text/css" href="lib/icheck/icheck.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script>
<![endif]-->
<!--/meta 作为公共模版分离出去-->
<style>
  .showPic{opacity: 0;}
  /*#div1{display: none;}*/
  /*#div2{display: none;}*/
  /*#div3{display: none;}*/
  /*#div4{display: none;}*/
  /*#div5{display: none;}*/
</style>
<title>添加活动</title>
</head>
<body>
<div class="layui-layer-title tab" style="cursor: pointer;">添加活动</div>

<span class="layui-layer-setwin"><a class="layui-layer-ico layui-layer-close layui-layer-close1" href="javascript:;" onclick="window.location.href='activity-list.html'"></a></span>
<article class="page-container">
  <div class="form form-horizontal" id="form-article-add">
    <div class="row cl">
                  <label class="form-label col-xs-4 col-sm-2">活动标题：</label>
                  <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="请输入活动标题" id="d_name" >
                  </div>
            </div>
            <div class="row cl">
                  <label class="form-label col-xs-4 col-sm-2">活动地址：</label>
                  <div class="formControls col-xs-8 col-sm-9">
                        <input type="text" class="input-text" value="" placeholder="www.baidu.com"  id="activityUrl" >
                  </div>
            </div>
            <div class="row cl">
                  <label class="form-label col-xs-4 col-sm-2">活动方式：</label>
                  <div class="formControls col-xs-8 col-sm-9">
                        <select class="input-text"  id="d_type" onclick="select(this)">
                            <option value="10">线上</option>
                            <option value="20">线下</option>
                            <option value="30">报名</option>
                        </select>
                  </div>
            </div>

      <div class="row cl" id="div1" >
          <label class="form-label col-xs-4 col-sm-2">活动简介：</label>
          <div class="formControls col-xs-8 col-sm-9">
              <textarea placeholder="请输入活动简介"  id="intro" name="intro" style="width: 500px;height: 80px;" type="text"></textarea>
          </div>
      </div>

      <div class="row cl" id="div2">
          <label class="form-label col-xs-4 col-sm-2">外部链接：</label>
          <div class="formControls col-xs-8 col-sm-9">
              <input type="text" class="input-text"  placeholder="请输入活动链接" id="outUrl" >
          </div>
      </div>

      <div class="row cl"  id="div3">
          <label class="form-label col-xs-4 col-sm-2">活动详细描述：</label>
          <div class="formControls col-xs-8 col-sm-9">
              <textarea placeholder="请输入详细描述" id="detail" name="detail" style="width: 500px;height: 80px;" type="text"></textarea>
          </div>
      </div>

      <div class="row cl" id="div4">
          <label class="form-label col-xs-4 col-sm-2">活动开始时间：</label>
          <div class="formControls col-xs-8 col-sm-9">
              <input type="text" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" id="startTime" class="input-text Wdate" style="width:200px;" value="">
          </div>
      </div>

      <div class="row cl" id="div5">
          <label class="form-label col-xs-4 col-sm-2">活动结束时间：</label>
          <div class="formControls col-xs-8 col-sm-9">
              <input type="text" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" id="endTime" class="input-text Wdate" style="width:200px;" value="">
          </div>
      </div>

            <div class="row cl">
             <label class="form-label col-xs-4 col-sm-2"><a href="javascript:;" id="sub" style="display: block;padding: .65rem;background: red;text-align: center;color: #fff;width: 80px;float: right;margin-right: -135px;">添加</a></label>
            </div>
            <div class="row cl showPic">
                <label class="form-label col-xs-4 col-sm-2">添加图片：</label>
                <div class="col-sm-9">
                    <div id="picker" style="position: relative;width: 108px;height: 128px;line-height: 128px;text-align: center;border: 1px solid #ddd;float: left">&nbsp;&nbsp;&nbsp;&nbsp;</div>
                     <div id="thelist" class="uploader-list " style="float: left;margin-bottom: 10px"></div>
                </div>
            </div>
             <div class="row cl showPic">
             <label class="form-label col-xs-4 col-sm-2"><a href="javascript:;" id="sub1" style="display: block;padding: .65rem;background: red;text-align: center;color: #fff;width: 80px;float: right;margin-right: -135px;margin-top: 20px;">添加</a></label>
            </div>



  </div>
</article>
<input type="hidden" value="" id="posId">
<input type="hidden" value="" id="film">
<!--_footer 作为公共模版分离出去-->
<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script> 
<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="lib/icheck/jquery.icheck.min.js"></script> 
<script type="text/javascript" src="lib/jquery.validation/1.14.0/jquery.validate.min.js"></script> 
<script type="text/javascript" src="lib/jquery.validation/1.14.0/validate-methods.js"></script> 
<script type="text/javascript" src="lib/jquery.validation/1.14.0/messages_zh.min.js"></script> 
<script type="text/javascript" src="static/h-ui/js/H-ui.js"></script> 
<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.js"></script>
<script type="text/javascript" src="lib/jquery.cookie.js"></script>
<script type="text/javascript" src="lib/common.js"></script>
<!--/_footer /作为公共模版分离出去-->

<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="lib/My97DatePicker/WdatePicker.js"></script>  
<script type="text/javascript" src="lib/webuploader/0.1.5/webuploader.js"></script> 

</body>
</html>
<script>
$(function(){
  var userId = $.cookie("userId");
  var roleType = $.cookie("roleType");
  var username = $.cookie("username");
  if(userId==""||userId==null){
    window.location.href="login.html"
  }
})
$("#sub").click(function(){
    var id=$.cookie("userId");
    var accessToken=$.cookie("accessToken");
    var title=$("#d_name").val();
    var activityUrl=$("#activityUrl").val();
    var type=$("#d_type").val();

    var intro = $("#intro").val();
    var outUrl = $("#outUrl").val();
    var detail = $("#detail").val();
    var startTime = $("#startTime").val();
    var endTime = $("#endTime").val();
//    console.log(startTime);
//    console.log(endTime);

      if (title==""||activityUrl=="") {
            alert("请正确添加活动")
      }else{
        $.ajax({
                url: getRootPath_dc() + '/system/addActivity',
                  type: "post",
                  dataType: "json",
                  headers:{tokenUserId:id,accessToken:accessToken},
                  data:{title:title,activityUrl:activityUrl,type:type,intro:intro,
                      outUrl:outUrl,detail:detail,startTime:startTime,endTime:endTime},
                  success:function(data){
                console.log(data)
                    $("#posId").val(data.data.id)
                    alert(data.msg)
                    // 添加图片
                    $(function(){
                       var $list = $('#thelist');
                       var $btn1 = $('#sub1');
                       var thumbnailWidth = 100;
                       var thumbnailHeight = 100;
                       var fkPurposeId=data.data.id;

                       console.log(fkPurposeId)
                       var uploader
                           uploader = WebUploader.create({
                              auto: false,
                              swf: 'js/Uploader.swf',
                              server: getRootPath_dc() + '/file/uploadFile',
                              pick: '#picker',
                              fileVal:'uploadFile',
                              formData: {'fileType':'image','filePurpose':'imageActivity','fkPurposeId':fkPurposeId},
                              fileNumLimit:3,
                              threads:3,
                              chunkRetry:3,
                              accept: {
                                  title: 'Images',
                                  extensions: 'gif,jpg,jpeg,bmp,png',
                                  mimeTypes: 'image/*'
                              },
                              method:'post',
                       });
                        uploader.on( 'fileQueued', function( file ) {
                            var $li = $(
                                    '<div id="' + file.id + '" class="file-item thumbnail remove-this">' +
                                        '<img>' +
                                        '<div class="info">' + file.name + '</div>' +
                                    '</div>'
                                    ),
                                $img = $li.find('img');

                            // $list为容器jQuery实例
                               $list.prepend( $li );
                            // 创建缩略图
                            // 如果为非图片文件，可以不用调用此方法。
                            // thumbnailWidth x thumbnailHeight 为 100 x 100
                            uploader.makeThumb( file, function( error, src ) {
                                if ( error ) {
                                    $img.replaceWith('<span>不能预览</span>');
                                    return;
                                }
                                    $img.attr( 'src', src );
                                }, thumbnailWidth, thumbnailHeight );
                            // $(".remove-this").live('click', function() {
                            //    alert(0)
                            //     uploader.removeFile(file,true);
                            // })
                       });
                       uploader.on( 'uploadSuccess', function( file ) {
                           alert( file.name+'上传成功');
                           console.log(file)
                       });
                        uploader.on( 'uploadError', function( file ) {
                            var $li = $( '#'+file.id ),
                                $error = $li.find('div.error');

                            // 避免重复创建
                            if ( !$error.length ) {
                                $error = $('<div class="error"></div>').appendTo( $li );
                            }

                            $error.text('上传失败');
                        });
                           $btn1.on( 'click', function() {
                            var fkPurposeId=$("#posId").val();
                            if (fkPurposeId=="") {
                                alert("上传有误");
                            }else{
                                uploader.upload();
                            }
                           });
                    })
                    // 添加图片结束
                  },
                  complete:function(data){
                    $(".showPic").css("opacity","1");
                  }

        })
      }
})

function getQueryString(id) { 
    var reg = new RegExp("(^|&)" + id + "=([^&]*)(&|$)", "i"); 
    var r = window.location.search.substr(1).match(reg); 
    if (r != null) return unescape(r[2]); return null; 
} 


function  select(value) {

    var selectedOption = value.options[value.selectedIndex];

//    if(selectedOption.value == "30"){
//        var div1=document.getElementById("div1");
//        var div2=document.getElementById("div2");
//        var div3=document.getElementById("div3");
//        var div4=document.getElementById("div4");
//        var div5=document.getElementById("div5");
//        div1.style.display='block';
//        div2.style.display='block';
//        div3.style.display='block';
//        div4.style.display='block';
//        div5.style.display='block';
//
//    }
//    else {
//        var div1=document.getElementById("div1");
//        var div2=document.getElementById("div2");
//        var div3=document.getElementById("div3");
//        var div4=document.getElementById("div4");
//        var div5=document.getElementById("div5");
//        div1.style.display='none';
//        div2.style.display='none';
//        div3.style.display='none';
//        div4.style.display='none';
//        div5.style.display='none';
//
//    }

}

</script>